!function(e){"use strict";e.module("ng-context-menu",[]).factory("ContextMenuService",function(){return{element:null,menus:{}}}).directive("contextMenu",["$document","ContextMenuService",function(n,t){return{restrict:"A",scope:{callback:"&contextMenu",disabled:"&contextMenuDisabled",closeCallback:"&contextMenuClose",treeNode:"=contextMenuTreeNode"},link:function(o,c,i){function l(){var e=t.menus[i.target];return e?e:(console.error("No menu at target: ",i.target),null)}function u(e,n){n||(n=l());var t=e.pageX,o=e.pageY;a(o,t)}function r(e,n){var t=e.getBoundingClientRect(),o=t.right,c=t.top-.5*t.height;n&&"string"==typeof n&&(n.indexOf("bottom")>-1?c=t.bottom:n.indexOf("top")>-1&&(c=t.top),n.indexOf("left")>-1?o=t.left:n.indexOf("right")>-1&&(o=t.right)),a(c,o)}function a(e,o){var c=l();for(var i in t.menus){var u=t.menus[i];u!==c&&u.removeClass("open")}c.addClass("open");var r=n[0].documentElement,a=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),s=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),d=c[0].scrollWidth,f=c[0].scrollHeight,p=r.clientWidth+a,m=r.clientHeight+s,x=d+event.pageX,b=f+event.pageY;x>p&&(o=window.innerWidth-c[0].scrollWidth),b>m&&(e=window.innerHeight-c[0].scrollHeight),c.css("top",e+"px"),c.css("left",o+"px"),g=!0}function s(){for(var e in t.menus)t.menus[e].removeClass("open");g&&o.closeCallback(),g=!1}function d(e){o.disabled()||(s(),t.element=e.target,e.preventDefault(),e.stopPropagation(),o.$apply(function(){o.callback({$event:e})}),o.$apply(function(){u(e)}))}function f(e){!o.disabled()&&g&&27===e.keyCode&&o.$apply(function(){s()})}function p(e){o.disabled()||!g||2===e.button&&e.target===t.element||o.$apply(function(){s()})}var g=!1;o.leftClick=i.contextMenuLeftClick;var m=e.element(document.getElementById(i.target));t.menus[i.target]=m,o.treeNode?(o.treeNode.contextMenuFunctions={},o.treeNode.contextMenuFunctions.openOn=r,o.treeNode.contextMenuFunctions.openAt=a,o.treeNode.contextMenuFunctions.close=s):console.warn("no scope.treeNode object");var x="contextmenu";o.leftClick&&(x="click"),c.bind(x,d),n.bind("keyup",f),n.bind("click",p),n.bind("contextmenu",p),o.$on("$destroy",function(){s(),n.unbind("keyup",f),n.unbind("click",p),n.unbind("contextmenu",p)})}}}])}(angular);