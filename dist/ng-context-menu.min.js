!function(e){"use strict";e.module("ng-context-menu",[]).factory("ContextMenuService",function(){return{element:null,menus:{}}}).directive("contextMenu",["$document","ContextMenuService",function(n,t){return{restrict:"A",scope:{callback:"&contextMenu",disabled:"&contextMenuDisabled",closeCallback:"&contextMenuClose",treeNode:"=contextMenuTreeNode",isLumxDropdown:"&"},link:function(o,i,c){function l(){if(g)return $(document.getElementById(c.target));var e=t.menus[c.target];return e?e:(console.error("No menu at target: ",c.target),null)}function r(e,n){n||(n=l());var t=e.pageX,o=e.pageY;a(o,t)}function u(e,n){var t=e.getBoundingClientRect(),o=t.right,i=t.top-.5*t.height;n&&"string"==typeof n&&(n.indexOf("bottom")>-1?i=t.bottom:n.indexOf("top")>-1&&(i=t.top),n.indexOf("left")>-1?o=t.left:n.indexOf("right")>-1&&(o=t.right)),a(i,o)}function a(o,i){var c=l();if(g){var r=e.element(c).scope();r.isOpened=!0}for(var u in t.menus){var a=t.menus[u];a!==c&&a.removeClass("open")}c.addClass("open");var d=n[0].documentElement,s=(window.pageXOffset||d.scrollLeft)-(d.clientLeft||0),f=(window.pageYOffset||d.scrollTop)-(d.clientTop||0),p=c[0].scrollWidth,x=c[0].scrollHeight,v=d.clientWidth+s,b=d.clientHeight+f,k=p+event.pageX,h=x+event.pageY;k>v&&(i=window.innerWidth-c[0].scrollWidth),h>b&&(o=window.innerHeight-c[0].scrollHeight),c.css("top",o+"px"),c.css("left",i+"px"),m=!0}function d(){for(var e in t.menus)t.menus[e].removeClass("open");m&&o.closeCallback(),m=!1}function s(e){o.disabled()||(d(),t.element=e.target,e.preventDefault(),e.stopPropagation(),o.$apply(function(){o.callback({$event:e})}),o.$apply(function(){r(e)}))}function f(e){!o.disabled()&&m&&27===e.keyCode&&o.$apply(function(){d()})}function p(e){o.disabled()||!m||2===e.button&&e.target===t.element||o.$apply(function(){d()})}var m=!1,g="true"==c.isLumxDropdown;o.leftClick=c.contextMenuLeftClick;var x=e.element(document.getElementById(c.target));t.menus[c.target]=x,o.treeNode?(o.treeNode.contextMenuFunctions={},o.treeNode.contextMenuFunctions.openOn=u,o.treeNode.contextMenuFunctions.openAt=a,o.treeNode.contextMenuFunctions.close=d):console.warn("no scope.treeNode object");var v="contextmenu";o.leftClick&&(v="click"),i.bind(v,s),n.bind("keyup",f),n.bind("click",p),n.bind("contextmenu",p),o.$on("$destroy",function(){d(),n.unbind("keyup",f),n.unbind("click",p),n.unbind("contextmenu",p)})}}}])}(angular);