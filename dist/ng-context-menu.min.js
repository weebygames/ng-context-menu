!function(e){"use strict";e.module("ng-context-menu",[]).factory("ContextMenuService",function(){return{element:null,menuElement:null}}).directive("contextMenu",["$document","ContextMenuService",function(n,t){return{restrict:"A",scope:{callback:"&contextMenu",disabled:"&contextMenuDisabled",closeCallback:"&contextMenuClose",treeNode:"=contextMenuTreeNode"},link:function(o,c,l){function u(e,t){var o=n[0].documentElement,c=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),l=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),u=t[0].scrollWidth,i=t[0].scrollHeight,m=o.clientWidth+c,d=o.clientHeight+l,r=u+e.pageX,s=i+e.pageY,p=Math.max(e.pageX-c,0),f=Math.max(e.pageY-l,0);r>m&&(p-=r-m),s>d&&(f-=s-d),a(f,p)}function i(e){console.log("openOn: ",e);var n=e.getBoundingClientRect(),t=n.right,o=n.top-.5*n.height;a(o,t)}function a(e,n){t.menuElement.addClass("open"),t.menuElement.css("top",e+"px"),t.menuElement.css("left",n+"px"),p=!0}function m(){t.menuElement.removeClass("open"),p&&o.closeCallback(),p=!1}function d(e){o.disabled()||(m(t.menuElement),t.element=e.target,e.preventDefault(),e.stopPropagation(),o.$apply(function(){o.callback({$event:e})}),o.$apply(function(){u(e,t.menuElement)}))}function r(e){!o.disabled()&&p&&27===e.keyCode&&o.$apply(function(){m(t.menuElement)})}function s(e){o.disabled()||!p||2===e.button&&e.target===t.element||o.$apply(function(){m(t.menuElement)})}var p=!1;o.leftClick=l.contextMenuLeftClick,o.treeNode?(o.treeNode.contextMenuFunctions={},o.treeNode.contextMenuFunctions.openOn=i,o.treeNode.contextMenuFunctions.openAt=a,o.treeNode.contextMenuFunctions.close=m):console.warn("no scope.treeNode object");var f="contextmenu";o.leftClick&&(f="click"),c.bind(f,d),setTimeout(function(){t.menuElement=e.element(document.getElementById(l.target))}),n.bind("keyup",r),n.bind("click",s),n.bind("contextmenu",s),o.$on("$destroy",function(){var e=t.menuElement;e&&e.removeClass("open"),n.unbind("keyup",r),n.unbind("click",s),n.unbind("contextmenu",s)})}}}])}(angular);