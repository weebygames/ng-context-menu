!function(e){"use strict";e.module("ng-context-menu",[]).factory("ContextMenuService",function(){return{element:null,menus:{}}}).directive("contextMenu",["$document","ContextMenuService",function(n,t){return{restrict:"A",scope:{callback:"&contextMenu",disabled:"&contextMenuDisabled",closeCallback:"&contextMenuClose",treeNode:"=contextMenuTreeNode"},link:function(o,c,u){function i(){var e=t.menus[u.target];return e?e:(console.error("No menu at target: ",u.target),null)}function l(e,t){t||(t=i());var o=n[0].documentElement,c=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),u=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),l=t[0].scrollWidth,a=t[0].scrollHeight,s=o.clientWidth+c,d=o.clientHeight+u,p=l+e.pageX,f=a+e.pageY,m=Math.max(e.pageX-c,0),g=Math.max(e.pageY-u,0);p>s&&(m-=p-s),f>d&&(g-=f-d),r(g,m)}function a(e){var n=e.getBoundingClientRect(),t=n.right,o=n.top-.5*n.height;r(o,t)}function r(e,n){var o=i();for(var c in t.menus){var u=t.menus[c];u!==o&&u.removeClass("open")}o.addClass("open"),o.css("top",e+"px"),o.css("left",n+"px"),m=!0}function s(){for(var e in t.menus)t.menus[e].removeClass("open");m&&o.closeCallback(),m=!1}function d(e){o.disabled()||(s(),t.element=e.target,e.preventDefault(),e.stopPropagation(),o.$apply(function(){o.callback({$event:e})}),o.$apply(function(){l(e)}))}function p(e){!o.disabled()&&m&&27===e.keyCode&&o.$apply(function(){s()})}function f(e){o.disabled()||!m||2===e.button&&e.target===t.element||o.$apply(function(){s()})}var m=!1;o.leftClick=u.contextMenuLeftClick;var g=e.element(document.getElementById(u.target));t.menus[u.target]=g,o.treeNode?(o.treeNode.contextMenuFunctions={},o.treeNode.contextMenuFunctions.openOn=a,o.treeNode.contextMenuFunctions.openAt=r,o.treeNode.contextMenuFunctions.close=s):console.warn("no scope.treeNode object");var x="contextmenu";o.leftClick&&(x="click"),c.bind(x,d),n.bind("keyup",p),n.bind("click",f),n.bind("contextmenu",f),o.$on("$destroy",function(){s(),n.unbind("keyup",p),n.unbind("click",f),n.unbind("contextmenu",f)})}}}])}(angular);